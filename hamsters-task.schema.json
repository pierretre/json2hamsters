{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://raw.githubusercontent.com/pierretre/json2hamsters/main/hamsters-task.schema.json",
    "title": "HAMSTERS Task Definition",
    "description": "Schema for validating HAMSTERS task definitions in JSON format",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "JSON Schema reference for IDE support"
        },
        "id": {
            "type": "string",
            "description": "Unique task identifier (auto-generated if omitted)",
            "pattern": "^[a-zA-Z0-9_-]+$"
        },
        "label": {
            "type": "string",
            "description": "Task label (required)",
            "minLength": 1,
            "maxLength": 200
        },
        "type": {
            "type": "string",
            "description": "Task type",
            "enum": [
                "abstract",
                "goal",
                "user",
                "system",
                "cognitive",
                "interaction",
                "cooperative"
            ]
        },
        "description": {
            "type": "string",
            "description": "Task description",
            "maxLength": 1000
        },
        "operator": {
            "$ref": "#/definitions/operator",
            "description": "Optional operator node containing this task's sub-structure"
        },
        "duration": {
            "type": "object",
            "description": "Task duration",
            "properties": {
                "min": {
                    "type": "number",
                    "description": "Minimum duration",
                    "minimum": 0,
                    "maximum": 1000000
                },
                "max": {
                    "type": "number",
                    "description": "Maximum duration",
                    "minimum": 0,
                    "maximum": 1000000
                },
                "unit": {
                    "type": "string",
                    "description": "Time unit",
                    "enum": [
                        "ms",
                        "s",
                        "min",
                        "h"
                    ]
                }
            },
            "additionalProperties": false
        },
        "loop": {
            "type": "object",
            "description": "Loop configuration",
            "properties": {
                "minIterations": {
                    "type": "integer",
                    "description": "Minimum number of iterations",
                    "minimum": 0,
                    "maximum": 10000
                },
                "maxIterations": {
                    "type": "integer",
                    "description": "Maximum number of iterations",
                    "minimum": 0,
                    "maximum": 10000
                }
            },
            "additionalProperties": false
        },
        "optional": {
            "type": "boolean",
            "description": "Whether the task is optional"
        },
        "metadata": {
            "type": "object",
            "description": "Additional metadata",
            "additionalProperties": true,
            "maxProperties": 50
        },
        "datas": {
            "type": "array",
            "description": "Data objects (DOD - Description of Data) used in the task model",
            "items": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Optional data identifier",
                        "pattern": "^[a-zA-Z0-9_-]+$"
                    },
                    "type": {
                        "type": "string",
                        "description": "Data type (DOD classification)",
                        "enum": [
                            "objectdod",
                            "informationdod",
                            "deviceouputdod",
                            "deviceinputdod",
                            "timedurationdatadod",
                            "deviceiodod",
                            "hwsystemdod",
                            "situationaldod",
                            "strategicdod",
                            "timedatadod",
                            "systemdod",
                            "applicationdod",
                            "physicaldod",
                            "eventdadadod",
                            "declarativedod",
                            "calendareventdadadod"
                        ]
                    },
                    "description": {
                        "type": "string",
                        "description": "Data description",
                        "maxLength": 500
                    }
                },
                "required": [
                    "type",
                    "description"
                ],
                "additionalProperties": false
            },
            "maxItems": 100
        },
        "refs": {
            "type": "array",
            "description": "References to data objects (DOD) by their id",
            "items": {
                "type": "string",
                "pattern": "^[a-zA-Z0-9_-]+$"
            },
            "maxItems": 100
        },
        "errors": {
            "type": "array",
            "description": "Error objects in the task model",
            "items": {
                "type": "object",
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Optional error identifier",
                        "pattern": "^[a-zA-Z0-9_-]+$"
                    },
                    "type": {
                        "type": "string",
                        "description": "Error type classification",
                        "enum": [
                            "humanerror",
                            "slip",
                            "rbm",
                            "kbm",
                            "lapse"
                        ]
                    },
                    "description": {
                        "type": "string",
                        "description": "Error description",
                        "maxLength": 500
                    }
                },
                "required": [
                    "type",
                    "description"
                ],
                "additionalProperties": false
            },
            "maxItems": 100
        }
    },
    "definitions": {
        "operator": {
            "type": "object",
            "description": "Temporal operator node that can chain operators without intermediate tasks",
            "properties": {
                "type": {
                    "type": "string",
                    "description": "Temporal operator",
                    "enum": [
                        "enable",
                        "choice",
                        "order-independent",
                        "concurrency",
                        "loop",
                        "optional",
                        "interrupt",
                        "suspend_resume"
                    ]
                },
                "children": {
                    "type": "array",
                    "description": "Children of the operator (tasks or nested operators)",
                    "items": {
                        "oneOf": [
                            {
                                "$ref": "#"
                            },
                            {
                                "$ref": "#/definitions/operator"
                            }
                        ]
                    },
                    "minItems": 1,
                    "maxItems": 100
                }
            },
            "required": [
                "type",
                "children"
            ],
            "additionalProperties": false
        }
    },
    "required": [
        "label"
    ],
    "additionalProperties": false
}